RewriteEngine On

# NEW: Handle direct auth v1 API calls by redirecting to auth router
RewriteRule ^auth/v1/metadata(.*)$ auth/?path=/v1/metadata$1 [QSA,L]
RewriteRule ^auth/v1/users/([0-9]+)/configuration(.*)$ auth/?path=/v1/users/$1/configuration$2 [QSA,L]
RewriteRule ^auth/v1/users/([0-9]+)/challenges/(.+)$ auth/?path=/v1/users/$1/challenges/$2 [QSA,L]
RewriteRule ^auth/v1/approve2fa/(.+)$ auth/?path=/v1/approve2fa/$1 [QSA,L]
RewriteRule ^auth/v1/check2fa/(.+)$ auth/?path=/v1/check2fa/$1 [QSA,L]
RewriteRule ^auth/v1/(.*)$ auth/?path=/v1/$1 [QSA,L]

# Existing rules
# Redirect user-specific configuration to general configuration
RewriteRule ^v1/users/[0-9]+/configuration(.*)$ v1/configuration$1 [L,QSA]
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_FILENAME}\.php -f
RewriteRule ^(.*)$ $1.php [L]
